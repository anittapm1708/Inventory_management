<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="../static/search.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <title>Inventory Management Web App</title>
  </head>
  <body>
    <div>
      <h1 class="text-center mt-4 mb-5">Search Data</h1>
    </div>
    <div class="container">
      <div class="form-container">
        <form
          id="searchForm"
          action="/searchForm"
          method="POST"
          class="form-group"
        >
          <input type="hidden" id="table" name="table" />
          <input type="hidden" id="fetchedData" name="fetchedData" />
          <div class="row">
            <div class="col-md-2 mb-3">
              <label for="SERIAL_NUMBER" class="form-label">Serial Number</label>
              <input
                type="text"
                class="form-control"
                id="SERIAL_NUMBER"
                name="SERIAL_NUMBER"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="ACCOUNT_NAME" class="form-label">Account Name</label>
              <input
                type="text"
                class="form-control"
                id="ACCOUNT_NAME"
                name="ACCOUNT_NAME"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="PRIMARY_DBA" class="form-label">Primary DBA</label>
              <input
                type="text"
                class="form-control"
                id="PRIMARY_DBA"
                name="PRIMARY_DBA"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="BACKUP_DBA" class="form-label">Backup DBA</label>
              <input
                type="text"
                class="form-control"
                id="BACKUP_DBA"
                name="BACKUP_DBA"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="CUST_SERVICE_PARTNER" class="form-label">Customer Service Partner</label>
              <input
                type="text"
                class="form-control"
                id="CUST_SERVICE_PARTNER"
                name="CUST_SERVICE_PARTNER"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="TOM" class="form-label">TOM</label>
              <input type="text" class="form-control" id="TOM" name="TOM" />
            </div>
          </div>
          <div class="row">
            <div class="col-md-2 mb-3">
              <label for="LICENSE_OWNERSHIP_CUST_SVVS" class="form-label">License Ownership Cust Svvs</label>
              <input
                type="text"
                class="form-control"
                id="LICENSE_OWNERSHIP_CUST_SVVS"
                name="LICENSE_OWNERSHIP_CUST_SVVS"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="CSI_IF_CUST_PROVIDED_LICENSE" class="form-label">CSI If Cust Provided License</label>
              <input
                type="text"
                class="form-control"
                id="CSI_IF_CUST_PROVIDED_LICENSE"
                name="CSI_IF_CUST_PROVIDED_LICENSE"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="CUS_POINT_OF_CONTACT_APPLICATION_OWNER" class="form-label">CUS Point of Contact Application Owner</label>
              <input
                type="text"
                class="form-control"
                id="CUS_POINT_OF_CONTACT_APPLICATION_OWNER"
                name="CUS_POINT_OF_CONTACT_APPLICATION_OWNER"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="LOGIN_PROCEDURE" class="form-label">Login Procedure</label>
              <input
                type="text"
                class="form-control"
                id="LOGIN_PROCEDURE"
                name="LOGIN_PROCEDURE"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="SERVER_NAME" class="form-label">Server Name</label>
              <input
                type="text"
                class="form-control"
                id="SERVER_NAME"
                name="SERVER_NAME"
              />
            </div>
          </div>
          <div class="row">
            <div class="col-md-2 mb-3">
              <label for="IP_ADDRESS" class="form-label">IP Address</label>
              <input
                type="text"
                class="form-control"
                id="IP_ADDRESS"
                name="IP_ADDRESS"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="LOC_IDC" class="form-label">LOC IDC</label>
              <input
                type="text"
                class="form-control"
                id="LOC_IDC"
                name="LOC_IDC"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="OS_TYPE" class="form-label">OS Type</label>
              <input
                type="text"
                class="form-control"
                id="OS_TYPE"
                name="OS_TYPE"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="INSTANCE" class="form-label">Instance</label>
              <input
                type="text"
                class="form-control"
                id="INSTANCE"
                name="INSTANCE"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="DATABASE_NAME" class="form-label">Database Name</label>
              <input
                type="text"
                class="form-control"
                id="DATABASE_NAME"
                name="DATABASE_NAME"
              />
            </div>
          </div>
          <div class="row">
            <div class="col-md-2 mb-3">
              <label for="PLUGGABLE" class="form-label">Pluggable</label>
              <input
                type="text"
                class="form-control"
                id="PLUGGABLE"
                name="PLUGGABLE"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="DB_TYPE_DEV_PROD" class="form-label">DB Type Dev Prod</label>
              <input
                type="text"
                class="form-control"
                id="DB_TYPE_DEV_PROD"
                name="DB_TYPE_DEV_PROD"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="DB_ROLE" class="form-label">DB Role</label>
              <input
                type="text"
                class="form-control"
                id="DB_ROLE"
                name="DB_ROLE"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="IS_DB_DOWN" class="form-label">Is DB Down</label>
              <input
                type="text"
                class="form-control"
                id="IS_DB_DOWN"
                name="IS_DB_DOWN"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="LAST_UP_DOWN_DATE" class="form-label">Last Up Down Date</label>
              <input
                type="text"
                class="form-control"
                id="LAST_UP_DOWN_DATE"
                name="LAST_UP_DOWN_DATE"
              />
            </div>
          </div>
          <div class="row">
            <div class="col-md-2 mb-3">
              <label for="PRIM_SERVER" class="form-label">Primary Server</label>
              <input
                type="text"
                class="form-control"
                id="PRIM_SERVER"
                name="PRIM_SERVER"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="PRIM_INST" class="form-label">Primary Instance</label>
              <input
                type="text"
                class="form-control"
                id="PRIM_INST"
                name="PRIM_INST"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="INSTANCE_TYPE" class="form-label">Instance Type</label>
              <input
                type="text"
                class="form-control"
                id="INSTANCE_TYPE"
                name="INSTANCE_TYPE"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="DB_VERSION" class="form-label">DB Version</label>
              <input
                type="text"
                class="form-control"
                id="DB_VERSION"
                name="DB_VERSION"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="DB_EDITION_SE_EE" class="form-label">DB Edition SE EE</label>
              <input
                type="text"
                class="form-control"
                id="DB_EDITION_SE_EE"
                name="DB_EDITION_SE_EE"
              />
            </div>
          </div>
          <div class="row">
            <div class="col-md-2 mb-3">
              <label for="GRID_INFO" class="form-label">Grid Info</label>
              <input
                type="text"
                class="form-control"
                id="GRID_INFO"
                name="GRID_INFO"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="FILESYSTEM_ASM_FILESYSTEM" class="form-label">Filesystem ASM Filesystem</label>
              <input
                type="text"
                class="form-control"
                id="FILESYSTEM_ASM_FILESYSTEM"
                name="FILESYSTEM_ASM_FILESYSTEM"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="DB_SIZE_MB_GB_TB" class="form-label">DB Size MB GB TB</label>
              <input
                type="text"
                class="form-control"
                id="DB_SIZE_MB_GB_TB"
                name="DB_SIZE_MB_GB_TB"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="DBID" class="form-label">DBID</label>
              <input
                type="text"
                class="form-control"
                id="DBID"
                name="DBID"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="OS_WATCHER" class="form-label">OS Watcher</label>
              <input
                type="text"
                class="form-control"
                id="OS_WATCHER"
                name="OS_WATCHER"
              />
            </div>
          </div>
          <div class="row">
            <div class="col-md-2 mb-3">
              <label for="BACKUP_TYPE" class="form-label">Backup Type</label>
              <input
                type="text"
                class="form-control"
                id="BACKUP_TYPE"
                name="BACKUP_TYPE"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="BACKUP_TO_DISK_TAPE" class="form-label">Backup to Disk Tape</label>
              <input
                type="text"
                class="form-control"
                id="BACKUP_TO_DISK_TAPE"
                name="BACKUP_TO_DISK_TAPE"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="BACKUP_LOCATION_POLICY_OR_NFS_SHARED_LOCATION" class="form-label">Backup Location Policy or NFS Shared Location</label>
              <input
                type="text"
                class="form-control"
                id="BACKUP_LOCATION_POLICY_OR_NFS_SHARED_LOCATION"
                name="BACKUP_LOCATION_POLICY_OR_NFS_SHARED_LOCATION"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="BACKUP_SCRIPT_LOCATION" class="form-label">Backup Script Location</label>
              <input
                type="text"
                class="form-control"
                id="BACKUP_SCRIPT_LOCATION"
                name="BACKUP_SCRIPT_LOCATION"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="BACKUP_LOG_LOCATION" class="form-label">Backup Log Location</label>
              <input
                type="text"
                class="form-control"
                id="BACKUP_LOG_LOCATION"
                name="BACKUP_LOG_LOCATION"
              />
            </div>
          </div>
          <div class="row">
            <div class="col-md-2 mb-3">
              <label for="BACKUP_SCHEDULED" class="form-label">Backup Scheduled</label>
              <input
                type="text"
                class="form-control"
                id="BACKUP_SCHEDULED"
                name="BACKUP_SCHEDULED"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="CATALOG_Y_N" class="form-label">Catalog Y N</label>
              <input
                type="text"
                class="form-control"
                id="CATALOG_Y_N"
                name="CATALOG_Y_N"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="CATALOG_DB_SERVER" class="form-label">Catalog DB Server</label>
              <input
                type="text"
                class="form-control"
                id="CATALOG_DB_SERVER"
                name="CATALOG_DB_SERVER"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="CATALOG_USER" class="form-label">Catalog User</label>
              <input
                type="text"
                class="form-control"
                id="CATALOG_USER"
                name="CATALOG_USER"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="FULL_BACKUP_DETAILS" class="form-label">Full Backup Details</label>
              <input
                type="text"
                class="form-control"
                id="FULL_BACKUP_DETAILS"
                name="FULL_BACKUP_DETAILS"
              />
            </div>
          </div>
          <div class="row">
            <div class="col-md-2 mb-3">
              <label for="INCREMENTAL_BACKUP_DETAILS" class="form-label">Incremental Backup Details</label>
              <input
                type="text"
                class="form-control"
                id="INCREMENTAL_BACKUP_DETAILS"
                name="INCREMENTAL_BACKUP_DETAILS"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="ARCHIVE_BACKUP_DETAILS" class="form-label">Archive Backup Details</label>
              <input
                type="text"
                class="form-control"
                id="ARCHIVE_BACKUP_DETAILS"
                name="ARCHIVE_BACKUP_DETAILS"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="MONITORED_BY" class="form-label">Monitored By</label>
              <input
                type="text"
                class="form-control"
                id="MONITORED_BY"
                name="MONITORED_BY"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="LAST_AUDIT_DATE" class="form-label">Last Audit Date</label>
              <input
                type="text"
                class="form-control"
                id="LAST_AUDIT_DATE"
                name="LAST_AUDIT_DATE"
              />
            </div>
            <div class="col-md-2 mb-3">
              <label for="LAST_AUDITED_BY" class="form-label">Last Audited By</label>
              <input
                type="text"
                class="form-control"
                id="LAST_AUDITED_BY"
                name="LAST_AUDITED_BY"
              />
            </div>
          </div>
          <div class="submit-btn">
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
          <div class="export-btn mt-3">
            <button type="button" id="exportButton" class="btn btn-success">
              Export as Excel
            </button>
          </div>
        </form>
      </div>
      <div class="search-table">
        <div id="loading" style="display: none;">Loading...</div>
        <table id="results">
          <thead>
            <tr>
              <th>SERIAL_NUMBER</th>
              <th>ACCOUNT_NAME</th>
              <th>PRIMARY_DBA</th>
              <th>BACKUP_DBA</th>
              <th>CUST_SERVICE_PARTNER</th>
              <th>TOM</th>
              <th>LICENSE_OWNERSHIP_CUST_SVVS</th>
              <th>CSI_IF_CUST_PROVIDED_LICENSE</th>
              <th>CUS_POINT_OF_CONTACT_APPLICATION_OWNER</th>
              <th>LOGIN_PROCEDURE</th>
              <th>SERVER_NAME</th>
              <th>IP_ADDRESS</th>
              <th>LOC_IDC</th>
              <th>OS_TYPE</th>
              <th>INSTANCE</th>
              <th>DATABASE_NAME</th>
              <th>PLUGGABLE</th>
              <th>DB_TYPE_DEV_PROD</th>
              <th>DB_ROLE</th>
              <th>IS_DB_DOWN</th>
              <th>LAST_UP_DOWN_DATE</th>
              <th>PRIM_SERVER</th>
              <th>PRIM_INST</th>
              <th>INSTANCE_TYPE</th>
              <th>DB_VERSION</th>
              <th>DB_EDITION_SE_EE</th>
              <th>GRID_INFO</th>
              <th>FILESYSTEM_ASM_FILESYSTEM</th>
              <th>DB_SIZE_MB_GB_TB</th>
              <th>DBID</th>
              <th>OS_WATCHER</th>
              <th>BACKUP_TYPE</th>
              <th>BACKUP_TO_DISK_TAPE</th>
              <th>BACKUP_LOCATION_POLICY_OR_NFS_SHARED_LOCATION</th>
              <th>BACKUP_SCRIPT_LOCATION</th>
              <th>BACKUP_LOG_LOCATION</th>
              <th>BACKUP_SCHEDULED</th>
              <th>CATALOG_Y_N</th>
              <th>CATALOG_DB_SERVER</th>
              <th>CATALOG_USER</th>
              <th>FULL_BACKUP_DETAILS</th>
              <th>INCREMENTAL_BACKUP_DETAILS</th>
              <th>ARCHIVE_BACKUP_DETAILS</th>
              <th>MONITORED_BY</th>
              <th>LAST_AUDIT_DATE</th>
              <th>LAST_AUDITED_BY</th>
            </tr>
          </thead>
          <tbody id="results-body"></tbody>
          <!-- Results will be displayed here -->
        </table>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.2.1/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
      // Function to get query parameters from the URL
      function getQueryParams() {
        const params = {};
        const queryString = window.location.search.substring(1);
        const regex = /([^&=]+)=([^&]*)/g;
        let m;
        while ((m = regex.exec(queryString))) {
          params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
        }
        return params;
      }

      document.addEventListener("DOMContentLoaded", function () {
        const params = getQueryParams();
        if (params.table) {
          document.getElementById("table").value = params.table;
          console.log("table:", params.table);
        }
      });

      document.getElementById("searchForm").addEventListener("submit", async function (event) {
        event.preventDefault();
        const loadingIndicator = document.getElementById("loading");
        loadingIndicator.style.display = "block";
        const formData = new FormData(this);
        const jsonData = {};
        formData.forEach((value, key) => {
          jsonData[key] = value;
        });
        console.log("jsonData:", jsonData);
        const responseData = await fetch("/searchForm", {
          method: "POST",
          body: JSON.stringify(jsonData),
          headers: {
            "Content-Type": "application/json",
          },
        }).then((response) => response.json());
        loadingIndicator.style.display = "none";

        // Update the table with the results
        const resultsBody = document.getElementById("results-body");
        resultsBody.innerHTML = ""; // Clear previous results

        if (Array.isArray(responseData) && responseData.length > 0) {
          for (const row of responseData) {
            resultsBody.innerHTML += `<tr>${row
              .map((value) => `<td>${value}</td>`)
              .join("")}</tr>`;
          }
        } else {
          resultsBody.innerHTML = '<tr><td colspan="100%">No results found</td></tr>';
        }
      });

      // Export results as Excel file
      document.getElementById("exportButton").addEventListener("click", function () {
        const table = document.getElementById("results");
        const workbook = new ExcelJS.Workbook();
        const worksheet = workbook.addWorksheet("Results");

        // Add header row
        const header = Array.from(table.querySelectorAll("th")).map((th) => th.innerText);
        worksheet.addRow(header);

        // Add data rows
        Array.from(table.querySelectorAll("tbody tr")).forEach((tr) => {
          const row = Array.from(tr.querySelectorAll("td")).map((td) => td.innerText);
          worksheet.addRow(row);
        });

        workbook.xlsx.writeBuffer().then((buffer) => {
          saveAs(new Blob([buffer]), "results.xlsx");
        });
      });
    </script>
  </body>
</html>
